<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Millo's Doggos</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="icon" href="img/MILOS-DOGGOS_ICONO_01.png" type="image/icon type">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/fontawesome/css/fontawesome.css">
    <link rel="stylesheet" href="css/fontawesome/css/solid.css">
    <script src="js/Chart.js"></script>
    <link rel="stylesheet" href="css/jquery.dataTables.min.css">
    <script src="js/jquery.dataTables.min.js"></script>
    <style>
        @font-face {
            font-family: trendy;
            src: url(fonts/trendy.ttf);
        }

        body {
            font-family: trendy;
        }

        .row.content {
            height: 550px
        }

        .sidenav {
            background-color: #f1f1f1;
            height: 100%;
        }

        @media screen and (max-width: 767px) {
            .row.content {
                height: auto;
            }
        }
    </style>
    <script>
        var storedValue = sessionStorage.getItem('usuario');
        var rol = sessionStorage.getItem('rol');
        if (!storedValue || rol != 0) {
            window.location.href = "login.html";
        }
    </script>
</head>

<body>
    <nav class="navbar navbar-inverse visible-xs" style="background-color: #3d5aa5;">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#"> <img width="60" height="60" style="margin-top: -25px;"
                        src="img/MILOS-DOGGOS_ICONO_01_02.png" alt="Logo">
                </a>
                <h4>ðŸŒ­ Bienvenido Cliente ðŸŒ­</h4>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li class="active"><a id="ofertasOption2" href="#">Ofertas</a></li>
                    <li><a id="pedidosOption2" href="#">Pedidos</a></li>
                    <li><a id="perfilOption2" href="#">Perfil</a></li>
                    <li><a href="index.html">Salir</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row content">
            <div class="col-3 col-sm-3 sidenav hidden-xs">
                <img style="width: 100%;" height="200" src="img/MILOS-DOGGOS_ICONO_02_resize.png" alt="Logo">
                <br>
                <h4>ðŸŒ­ Bienvenido Cliente ðŸŒ­</h4>
                <ul class="nav nav-pills nav-stacked">
                    <li class="active"><a id="ofertasOption" href="#">Ofertas</a></li>
                    <li><a id="pedidosOption"  href="#">Pedidos</a></li>
                    <li><a id="perfilOption" href="#">Perfil</a></li>
                    <li><a href="index.html">Salir</a></li>
                </ul><br>
            </div>
            <br>

            <div class="col-9 col-sm-9" id="ofertas">
                <div class="well" style="text-align: center;background-color: #3d5aa5; ">
                    <h1 style="color: white;">Ofertas</h1>
                </div>
                <div class="row">
                    <div class="col-sm-12" style="text-align: center; color: #3d5aa5;;">
                        <div class="well">
                            <h4>Oferta del Dia</h4>
                            <p id="oferta_name"></p>
                            <img id="oferta_img" class="img-responsive" style="width:30%; margin: 0 auto;" alt="Image">
                            <p id="oferta_info"></p>
                            <p style="font-family: 'Courier New', Courier, monospace;"><b style="text-decoration: line-through; color: red;" id="oferta_original"></b><b style="color: green;" id="oferta_nuevo"></b></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-9 col-sm-9" id="pedidos">

                <div class="well" style="text-align: center;background-color: #3d5aa5;">
                    <h1 style="color: white;">Pedidos</h1>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <a href="#" class="btn btn-block" style="background-color: #3d5aa5; color: white;" data-toggle="modal" data-target="#pedidoModal">ðŸŒ­ Nuevo Pedido ðŸŒ­</a>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-sm-12" style="font-family: 'Courier New', Courier, monospace; text-align: center; color: #3d5aa5;">
                        <div class="well">
                            <h4>Historial</h4>
                            <br>
                            <div class="card" style="margin: 0 auto; max-width: 600px;border: 2px solid #3d5aa5;">
                                <div class="card-header" style="background-color: #3d5aa5; color: white;">
                                    Pedido #12345
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">El Polaco</h5>
                                    <p class="card-text">Cantidad: 2</p>
                                    <p class="card-text">Precio: $100</p>
                                    <p class="card-text">Fecha: 2024-05-17</p>
                                    <a href="#" class="btn btn-primary">Ver Detalles</a>
                                    <br>
                                </div>
                            </div>
                            <br>
                            <div class="card" style="margin: 0 auto; max-width: 600px;border: 2px solid #3d5aa5;">
                                <div class="card-header" style="background-color: #3d5aa5; color: white;">
                                    Pedido #6789
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">El Basico</h5>
                                    <p class="card-text">Cantidad: 2</p>
                                    <p class="card-text">Precio: $110</p>
                                    <p class="card-text">Fecha: 2024-05-17</p>
                                    <a href="#" class="btn btn-primary">Ver Detalles</a>
                                    <br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="pedidoModal" tabindex="-1" role="dialog" aria-labelledby="pedidoModalLabel" aria-hidden="true" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="pedidoModalLabel">Nuevo Pedido</h5>
                                <button style="font-family: 'Courier New', Courier, monospace;" type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <img src="img/MILOS-DOGGOS_ICONO_01.png" class="img-responsive" style="width:30%; margin: 0 auto;" alt="Image">
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label for="tipo" style="color: #3d5aa5;">Tipo</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="tipo" id="tipo1" checked >
                                            <label class="form-check-label" for="tipo1">
                                                El Basico
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="tipo" id="tipo2">
                                            <label class="form-check-label" for="tipo2">
                                                El Polaco
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="tipo" id="tipo3">
                                            <label class="form-check-label" for="tipo3">
                                                El Gallego
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="tipo" style="color: #3d5aa5;">Ingredientes</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="toppings">
                                            <label class="form-check-label" for="toppings">
                                                Toppings
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="cebolla">
                                            <label class="form-check-label" for="cebolla">
                                                Cebolla
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="ketchup">
                                            <label class="form-check-label" for="ketchup">
                                                Ketchup
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="mayonesa">
                                            <label class="form-check-label" for="mayonesa">
                                                Mayonesa
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="mostaza">
                                            <label class="form-check-label" for="mostaza">
                                                Mostaza
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="pago" style="color: #3d5aa5;">Metodo de Pago</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="pago" id="efectivo" checked >
                                            <label class="form-check-label" for="efectivo">
                                                Efectivo
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="pago" id="paypal">
                                            <label class="form-check-label" for="paypal">
                                                PayPal
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="pago" id="transferencia">
                                            <label class="form-check-label" for="transferencia">
                                                Transferencia
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="envio" style="color: #3d5aa5;">Envio</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="envio" id="local" checked >
                                            <label class="form-check-label" for="local">
                                                Se recogera en el local
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="envio" id="direccion">
                                            <label class="form-check-label" for="direccion">
                                                Envio a mi direccion
                                            </label>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                <button type="button" class="btn btn-primary">Enviar Pedido</button>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <div class="col-9 col-sm-9" id="perfil">
                <div class="well" style="text-align: center;background-color: #3d5aa5; ">
                    <h1 style="color: white;">Perfil</h1>
                </div>
                <div class="row">
                    <div class="col-sm-12" style="text-align: center; color: #3d5aa5;;">
                        <div class="well">
                            <form id="perfilform">
                                <h4>Mi Perfil</h4>
                                <p>Da click en la imagen para subir una nueva</p>
                                <label for="avatar-upload">
                                    <img id="img_perfil" src="img/avatar.png" class="img-responsive" style="width:30%; margin: 0 auto; cursor: pointer;" alt="Image">
                                </label>
                                <input onchange="changeImg()" type="file" id="avatar-upload" name="img_perfil" style="display: none;">                                <br>
                                <div class="form-group">
                                    <label for="nombre">Nombre</label>
                                    <input required style="font-family: 'Courier New', Courier, monospace;" type="text" class="form-control" id="nombre" name="nombre"
                                        placeholder="Ingresa tu nombre completo">
                                </div>
                                <div class="form-group">
                                    <label for="email">Correo Electronico</label>
                                    <input required style="font-family: 'Courier New', Courier, monospace;" type="email" class="form-control" id="email" name="email"
                                        placeholder="Ingresa tu correo electronico">
                                </div>
                                <div class="form-group">
                                    <label for="direccion">Direccion</label>
                                    <input required style="font-family: 'Courier New', Courier, monospace;" type="text" class="form-control" id="direccion_perfil" name="direccion"
                                        placeholder="Ingresa tu direccion">
                                </div>
                                <div class="form-row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="edad">Edad</label>
                                            <input required style="font-family: 'Courier New', Courier, monospace;" type="number" class="form-control" id="edad" name="edad"
                                                placeholder="Ingresa tu edad">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="genero">Genero</label>
                                            <br>
                                            <select required id="genero" name="genero" class="form-control" style="font-family: 'Courier New', Courier, monospace;">
                                                <option>Selecciona una opcion</option>
                                                <option value="1">Femenimo</option>
                                                <option value="2">Masculino</option>
                                                <option value="3">Otro</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="nacimiento">Fecha Nacimiento</label>
                                            <input required style="font-family: 'Courier New', Courier, monospace;" type="date"
                                                class="form-control" id="nacimiento" name="nacimiento"
                                                placeholder="Ingresa tu fecha de nacimiento">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="opinion">Datos tu opinion<br><br> Que tipo de HotDog te gustan, tus toppings favoritos, etc</label>
                                    <textarea style="resize: none;font-family: 'Courier New', Courier, monospace;"  class="form-control" id="opinion" name="opinion" rows="5" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-block btn-primary">Guardar Datos</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="js/supabase.min.js"></script>
<script src="js/crypto-js.min.js"></script>
<script>
    const supabaseUrl = 'https://jfxowkbzdovqdpwpbxyg.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmeG93a2J6ZG92cWRwd3BieHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTY4Mzc1MDEsImV4cCI6MjAzMjQxMzUwMX0.owrR1NEhH7uOqLsQn3qUYWKLGQW3NeEQBbYnPyy9BB0';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    function getBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    $(document).ready(async function () {
        var id = sessionStorage.getItem('id');
        const { data: data, error: error } = await supabase
                .from('usuarios')
                .select('*')
                .eq('id', id);
        const { data: data2, error: error2 } = await supabase
                .from('system')
                .select('*')
                .eq('id', 1);
        
        if (error || error2) {
            alert('Error! Checa la conexiÃ³n con la base de datos');
        }else{
            var titulo = "";
            var info = "";
            var img = "";
            if(data2[0]["hotdog_oferta"] === 0){
                titulo = "EL POLACO";
                info = "Salchicha Polaca";
                img = "img/polaco.jpg";
            }else if(data2[0]["hotdog_oferta"] === 1){
                titulo = "EL CHE";
                info = "Salchicha Argentina";
                img = "img/che.jpg";
            }else if(data2[0]["hotdog_oferta"] === 2){
                titulo = "EL GALLEGO";
                info = "Salchicha EspaÃ±ola";
                img = "img/gallego.jpg";
            }else if(data2[0]["hotdog_oferta"] === 3){
                titulo = "EL ASADO";
                info = "Salchicha para Asar";
                img = "img/asar.jpg";
            }

            document.getElementById('oferta_name').innerText  = titulo;
            document.getElementById('oferta_img').src = img;
            document.getElementById('oferta_info').innerText  = info;
            document.getElementById('oferta_original').innerText  = data2[0]["original_oferta"];
            document.getElementById('oferta_nuevo').innerText  = " " + data2[0]["nuevo_oferta"];

            document.getElementById('nombre').value = data[0]["nombre"];
            document.getElementById('email').value = data[0]["email"];
            document.getElementById('direccion_perfil').value = data[0]["direccion"];
            document.getElementById('edad').value = data[0]["edad"];
            document.getElementById('genero').value = data[0]["genero"];
            document.getElementById('nacimiento').value = data[0]["nacimiento"];
            document.getElementById('opinion').value = data[0]["opinion"];

            document.getElementById('img_perfil').src = data[0]["foto"];
        }

        document.getElementById('perfilform').addEventListener('submit', async function(event) {
                event.preventDefault();

                var id = sessionStorage.getItem('id');

                const fileInput = document.getElementById('avatar-upload').files[0];

                var foto = null;

                if (fileInput) {
                    foto = await getBase64(fileInput);
                }

                const nombre = document.getElementById('nombre').value;
                const email = document.getElementById('email').value;
                const direccion = document.getElementById('direccion_perfil').value;
                const edad = document.getElementById('edad').value;
                const genero = document.getElementById('genero').value;
                const nacimiento = document.getElementById('nacimiento').value;
                const opinion = document.getElementById('opinion').value;

                const { data, error } = await supabase
                    .from('usuarios')
                    .update([
                        { nombre: nombre, 
                          email: email, 
                          direccion: direccion, 
                          edad: edad, 
                          genero: genero,
                          nacimiento: nacimiento, 
                          opinion: opinion,
                          foto: foto
                        }
                    ])
                    .eq('id', id);

                if (error) {
                    console.error('Error actualizando registro:', error);
                } else {
                    alert('Actualizamiento exitoso');
                    location.reload();
                }

        });
    });

    async function changeImg(){
            const fileInput = document.getElementById('avatar-upload').files[0];

            if (fileInput) {
                const base64String = await getBase64(fileInput);
                const jsonObject = {
                        image: base64String
                };
                document.getElementById('img_perfil').src = base64String;
            }
    }
</script>

<script>
    $('#pedidos').hide();
    $('#perfil').hide();

    $("#ofertasOption").click(function () {
        $(".nav-pills li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#ofertas').show();
        $('#pedidos').hide();
        $('#perfil').hide();
    });

    $("#ofertasOption2").click(function () {
        $(".navbar-nav li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#ofertas').show();
        $('#pedidos').hide();
        $('#perfil').hide();
    });

    $("#pedidosOption").click(function () {
        $(".nav-pills li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#ofertas').hide();
        $('#pedidos').show();
        $('#perfil').hide();
    });

    $("#pedidosOption2").click(function () {
        $(".navbar-nav li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#ofertas').hide();
        $('#pedidos').show();
        $('#perfil').hide();
    });

    $("#perfilOption").click(function () {
        $(".nav-pills li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#ofertas').hide();
        $('#pedidos').hide();
        $('#perfil').show();
    });

    $("#perfilOption2").click(function () {
        $(".navbar-nav li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#ofertas').hide();
        $('#pedidos').hide();
        $('#perfil').show();
    });
</script>


</html>