<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Millo's Doggos</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="icon" href="img/MILOS-DOGGOS_ICONO_01.png" type="image/icon type">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/fontawesome/css/fontawesome.css">
    <link rel="stylesheet" href="css/fontawesome/css/solid.css">
    <script src="js/Chart.js"></script>
    <link rel="stylesheet" href="css/jquery.dataTables.min.css">
    <script src="js/jquery.dataTables.min.js"></script>
    <style>
        @font-face {
            font-family: trendy;
            src: url(fonts/trendy.ttf);
        }

        body {
            font-family: trendy;
        }

        .row.content {
            height: 550px
        }

        .sidenav {
            background-color: #f1f1f1;
            height: 100%;
        }

        @media screen and (max-width: 767px) {
            .row.content {
                height: auto;
            }
        }

        table.dataTable {
            font-family: Arial, sans-serif;
        }

        .dataTables_info {
            font-family: Arial, sans-serif;
        }
    
        .dataTables_filter{
            font-family: Arial, sans-serif;
        }
    </style>
    <script>
        var storedValue = sessionStorage.getItem('usuario');
        var rol = sessionStorage.getItem('rol');
        if (!storedValue || rol != 1) {
            window.location.href = "login.html";
        }
    </script>
</head>

<body>
    <nav class="navbar navbar-inverse visible-xs" style="background-color: #3d5aa5;">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#"> <img width="60" height="60" style="margin-top: -25px;"
                        src="img/MILOS-DOGGOS_ICONO_01_02.png" alt="Logo">
                </a>
                <h4>Administrador üñ•Ô∏è</h4>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li class="active"><a id="dashboardOption2" href="#">Dashboard</a></li>
                    <li><a id="usuariosOption2" href="#">Usuarios</a></li>
                    <li><a href="index.html">Salir</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row content">
            <div class="col-3 col-sm-3 sidenav hidden-xs">
                <img style="width: 100%;" height="200" src="img/MILOS-DOGGOS_ICONO_02_resize.png" alt="Logo">
                <br>
                <h4>Administrador üñ•Ô∏è</h4>
                <ul class="nav nav-pills nav-stacked">
                    <li class="active"><a id="dashboardOption" href="#">Dashboard</a></li>
                    <li><a id="usuariosOption"  href="#">Usuarios</a></li>
                    <li><a href="index.html">Salir</a></li>
                </ul><br>
            </div>
            <br>

            <div class="col-9 col-sm-9" id="dashboard">
                <div class="well">
                    <h4>Dashboard</h4>
                    <p>Estadisticas generales del sistema</p>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <div class="well">
                            <h4>Usuarios Activos</h4>
                            <p id="activos_general"></p>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="well">
                            <h4>Clientes</h4>
                            <p id="num_clientes"></p>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="well">
                            <h4>Repartidores</h4>
                            <p id="num_repartidores"></p>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="well">
                            <h4>Cocineros</h4>
                            <p id="num_cocineros"></p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="well">
                            <canvas id="myChart" style="width:100%;max-width:700px"></canvas>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="well">
                            <canvas id="myChart2" style="width:100%;max-width:700px"></canvas>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="well">
                            <canvas id="myChart3" style="width:100%;max-width:700px"></canvas>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="well">
                            <canvas id="myChart4" style="width:100%;height: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-9 col-sm-9" id="usuarios">

                <div class="row">
                    <div class="col-sm-12">
                        <h2 style="color: #3d5aa5;">Usuarios del Sistema</h2>
                        <br>
                        <a href="#" class="btn btn-block" style="background-color: #3d5aa5; color: white;" data-toggle="modal" data-target="#addModal">Agregar</a>
                        <br>
                        <table id="example" class="display" style="width:100%">
                            <thead>
                                <tr style="color: #3d5aa5;">
                                    <th>Nombre</th>
                                    <th>Usuario</th>
                                    <th>Rol</th>
                                    <th>Estatus</th>
                                    <th>Editar</th>
                                    <th>Eliminar</th>
                                </tr>
                            </thead>
                            <tbody style="font-family: 'Courier New', Courier, monospace;">
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true" >
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">Nuevo Usuario</h5>
                    <button style="font-family: 'Courier New', Courier, monospace;" type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <img src="img/MILOS-DOGGOS_ICONO_01.png" class="img-responsive" style="width:30%; margin: 0 auto;" alt="Image">
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="tipo" style="color: #3d5aa5;">Tipo</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" id="tipo1" checked >
                                <label class="form-check-label" for="tipo1">
                                    El Basico
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" id="tipo2">
                                <label class="form-check-label" for="tipo2">
                                    El Polaco
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo" id="tipo3">
                                <label class="form-check-label" for="tipo3">
                                    El Gallego
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="tipo" style="color: #3d5aa5;">Ingredientes</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="toppings">
                                <label class="form-check-label" for="toppings">
                                    Toppings
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="cebolla">
                                <label class="form-check-label" for="cebolla">
                                    Cebolla
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="ketchup">
                                <label class="form-check-label" for="ketchup">
                                    Ketchup
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="mayonesa">
                                <label class="form-check-label" for="mayonesa">
                                    Mayonesa
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="mostaza">
                                <label class="form-check-label" for="mostaza">
                                    Mostaza
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pago" style="color: #3d5aa5;">Metodo de Pago</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="pago" id="efectivo" checked >
                                <label class="form-check-label" for="efectivo">
                                    Efectivo
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="pago" id="paypal">
                                <label class="form-check-label" for="paypal">
                                    PayPal
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="pago" id="transferencia">
                                <label class="form-check-label" for="transferencia">
                                    Transferencia
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="envio" style="color: #3d5aa5;">Envio</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="envio" id="local" checked >
                                <label class="form-check-label" for="local">
                                    Se recogera en el local
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="envio" id="direccion">
                                <label class="form-check-label" for="direccion">
                                    Envio a mi direccion
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary">Enviar Pedido</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="js/supabase.min.js"></script>
<script>
    $(document).ready(async function () {
        const supabaseUrl = 'https://jfxowkbzdovqdpwpbxyg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmeG93a2J6ZG92cWRwd3BieHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTY4Mzc1MDEsImV4cCI6MjAzMjQxMzUwMX0.owrR1NEhH7uOqLsQn3qUYWKLGQW3NeEQBbYnPyy9BB0';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        const { data, error } = await supabase
                .from('usuarios')
                .select('*')
                .eq('status', 1);
        if (error) {
            alert('Error! Checa la conexi√≥n con la base de datos');
        }else{
            $('#activos_general').text(data.length)
            var num_clientes = 0;
            var num_repartidores = 0;
            var num_cocineros = 0;
            var rol_texto = "";
            var table = $('#example').DataTable();

            data.forEach(user => {
                if(user["rol"] === 0){
                    num_clientes = num_clientes + 1;
                    rol_texto = "Cliente";
                }else if(user["rol"] === 3){
                    num_repartidores = num_repartidores + 1;
                    rol_texto = "Repartidor";
                }else if(user["rol"] === 2){
                    num_cocineros = num_cocineros + 1;
                    rol_texto = "Cocinero";
                }else if(user["rol"] === 1){
                    rol_texto = "Administrador";
                }

                var status_text = "";
                if(user["status"] === 1){
                    status_text = "Activo";
                }else{
                    status_text = "Inactivo";
                }

                var newData = [
                    user["nombre"],
                    user["usuario"],
                    rol_texto,
                    status_text,
                    "<i class='fa-solid fa-pencil'></i>",
                    "<i class='fa-solid fa-pencil'></i>"
                ];
                table.row.add(newData).draw(false);
            });
            $('#num_clientes').text(num_clientes);
            $('#num_repartidores').text(num_repartidores);
            $('#num_cocineros').text(num_cocineros)
        }
    });
</script>

<script>
    $(document).ready(function() {
        $('#example').DataTable({
            "language": {
                "sProcessing":     "Procesando...",
                "sLengthMenu":     "Mostrar _MENU_ registros",
                "sZeroRecords":    "No se encontraron resultados",
                "sEmptyTable":     "Ning√∫n dato disponible en esta tabla",
                "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix":    "",
                "sSearch":         "Buscar",
                "sUrl":            "",
                "sInfoThousands":  ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst":    "Primero",
                    "sLast":     "√öltimo",
                    "sNext":     "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                }
            }
        });
    });
</script>

<script>
    $('#usuarios').hide();

    $("#dashboardOption").click(function () {
        $(".nav-pills li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#dashboard').show();
        $('#usuarios').hide();
    });

    $("#dashboardOption2").click(function () {
        $(".navbar-nav li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#dashboard').show();
        $('#usuarios').hide();
    });

    $("#usuariosOption").click(function () {
        $(".nav-pills li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#dashboard').hide();
        $('#usuarios').show();
    });

    $("#usuariosOption2").click(function () {
        $(".navbar-nav li.active").removeClass("active");
        $(this).parent().addClass("active");
        $('#dashboard').hide();
        $('#usuarios').show();
    });
</script>

<script>
    var xyValues = [
        { x: 50, y: 7 },
        { x: 60, y: 8 },
        { x: 70, y: 8 },
        { x: 80, y: 9 },
        { x: 90, y: 9 },
        { x: 100, y: 9 },
        { x: 110, y: 10 },
        { x: 120, y: 11 },
        { x: 130, y: 14 },
        { x: 140, y: 14 },
        { x: 150, y: 15 }
    ];

    new Chart("myChart", {
        type: "scatter",
        data: {
            datasets: [{
                pointRadius: 4,
                pointBackgroundColor: "rgb(0,0,255)",
                data: xyValues
            }]
        },
        options: {
            legend: { display: false },
            scales: {
                xAxes: [{ ticks: { min: 40, max: 160 } }],
                yAxes: [{ ticks: { min: 6, max: 16 } }],
            }
        }
    });

    new Chart("myChart2", {
        type: "scatter",
        data: {
            datasets: [{
                pointRadius: 4,
                pointBackgroundColor: "rgb(0,0,255)",
                data: xyValues
            }]
        },
        options: {
            legend: { display: false },
            scales: {
                xAxes: [{ ticks: { min: 40, max: 160 } }],
                yAxes: [{ ticks: { min: 6, max: 16 } }],
            }
        }
    });

    new Chart("myChart3", {
        type: "scatter",
        data: {
            datasets: [{
                pointRadius: 4,
                pointBackgroundColor: "rgb(0,0,255)",
                data: xyValues
            }]
        },
        options: {
            legend: { display: false },
            scales: {
                xAxes: [{ ticks: { min: 40, max: 160 } }],
                yAxes: [{ ticks: { min: 6, max: 16 } }],
            }
        }
    });

    var xValues = ["Polaca", "Chorizo", "Chistorra", "Asar", "Cerdo"];
    var yValues = [55, 49, 44, 24, 15];
    var barColors = ["red", "green", "blue", "orange", "brown"];

    new Chart("myChart4", {
        type: "bar",
        data: {
            labels: xValues,
            datasets: [{
                backgroundColor: barColors,
                data: yValues
            }]
        },
        options: {
            legend: { display: false },
            title: {
                display: true,
                text: "Estadisticas de Venta del Mes"
            }
        }
    });

    var xValues2 = ["Italy", "France", "Spain", "USA", "Argentina"];
    var yValues2 = [55, 49, 44, 24, 15];
    var barColors2 = [
        "#b91d47",
        "#00aba9",
        "#2b5797",
        "#e8c3b9",
        "#1e7145"
    ];

</script>

</html>